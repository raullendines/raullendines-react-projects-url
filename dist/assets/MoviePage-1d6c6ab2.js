import{j as r,r as c}from"./index-7baecc66.js";var m=v;function v(e,s,a){var t=null,n=null,u=function(){t&&(clearTimeout(t),n=null,t=null)},f=function(){var i=n;u(),i&&i()},l=function(){if(!s)return e.apply(this,arguments);var i=this,h=arguments,p=a&&!t;if(u(),n=function(){e.apply(i,h)},t=setTimeout(function(){if(t=null,!p){var d=n;return n=null,d()}},s),p)return n()};return l.cancel=u,l.flush=f,l}function j({movies:e}){return r.jsx("ul",{className:"movies",children:e.map(s=>r.jsxs("li",{className:"movie",children:[r.jsx("h3",{children:s.title}),r.jsx("p",{children:s.year}),r.jsx("img",{src:s.poster,alt:s.title})]},s.id))})}function g(){}function b({movies:e}){return(e==null?void 0:e.length)>0?r.jsx(j,{movies:e}):r.jsx(g,{})}const M="1919779e",S=async({search:e})=>{if(e==="")return null;try{const t=(await(await fetch(`https://www.omdbapi.com/?apikey=${M}&s=${e}`)).json()).Search;return t==null?void 0:t.map(n=>({id:n.imdbID,title:n.Title,year:n.Year,poster:n.Poster}))}catch{throw new Error("Error searching movies")}};function y({search:e,sort:s}){const[a,t]=c.useState([]),[n,u]=c.useState(!1),[f,l]=c.useState(null),i=c.useRef(e),h=c.useCallback(async({search:d})=>{if(d!==i.current)try{u(!0),l(null),i.current=d;const o=await S({search:d});t(o)}catch(o){l(o.message)}finally{u(!1)}},[]);return{movies:c.useMemo(()=>s?[...a].sort((d,o)=>d.title.localeCompare(o.title)):a,[s,a]),getMovies:h,loading:n}}function w(){const[e,s]=c.useState(""),[a,t]=c.useState(null),n=c.useRef(!0);return c.useEffect(()=>{if(n.current){n.current=e==="";return}if(e===""){t("No se puede buscar una pelicula vacia");return}if(e.match(/^\d+$/)){t("No se puede buscar una pelicula con un número");return}if(e.length<3){t("La busqueda debe tener almenos 3 caracteres");return}t(null)},[e]),{search:e,updateSearch:s,error:a}}function E(){const[e,s]=c.useState(!1),{search:a,updateSearch:t,error:n}=w(),{movies:u,loading:f,getMovies:l}=y({search:a,sort:e}),i=c.useCallback(m(o=>{l({search:o})},300),[l]),h=o=>{o.preventDefault(),l({search:a})},p=o=>{const x=o.target.value;t(x),i(x)},d=()=>{s(!e)};return r.jsxs("div",{children:[r.jsxs("header",{children:[r.jsx("h1",{className:"title",children:"Buscador de peliculas"}),r.jsxs("form",{className:"form",onSubmit:h,children:[r.jsx("input",{onChange:p,name:"query",type:"text",value:a,placeholder:"Avengers, Kingsman..."}),r.jsx("input",{type:"checkbox",onClick:d}),r.jsx("button",{type:"submit",children:"Buscar"})]}),n&&r.jsx("p",{className:"error-text",children:n})]}),r.jsx("main",{children:f?r.jsx("p",{children:"Cargando..."}):u&&u.length>0?r.jsx(b,{movies:u}):r.jsx("p",{children:"No se encontraron películas."})})]})}export{E as default};
